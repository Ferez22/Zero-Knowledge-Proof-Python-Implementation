<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Code Display & Download Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .demo-section {
        margin: 20px 0;
        padding: 20px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .qr-display {
        text-align: center;
        margin: 20px 0;
      }
      .qr-image {
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 2px solid #e0e0e0;
        display: inline-block;
      }
      .qr-image img {
        width: 200px;
        height: 200px;
        object-fit: contain;
      }
      .download-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px;
        transition: background-color 0.3s;
      }
      .download-btn:hover {
        background: #0056b3;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }
      .code-block {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        font-family: monospace;
        overflow-x: auto;
        margin: 15px 0;
      }
    </style>
  </head>
  <body>
    <h1>üéØ QR Code Display & Download Demo</h1>

    <div class="demo-section">
      <h2>‚ú® New Features Added</h2>
      <div class="info">
        <strong>üéâ What's New:</strong>
        <ul>
          <li>
            <strong>QR Code Display:</strong> Generated QR codes now show
            directly on the website
          </li>
          <li>
            <strong>Direct Download:</strong> Users can download QR codes with
            one click
          </li>
          <li>
            <strong>Real-time Preview:</strong> See your QR code immediately
            after generation
          </li>
          <li>
            <strong>Secure Serving:</strong> Backend serves QR code images
            securely
          </li>
        </ul>
      </div>
    </div>

    <div class="demo-section">
      <h2>üì± Live QR Code Display</h2>
      <p>This demo shows how the QR code will appear on your website:</p>

      <div class="qr-display">
        <div class="qr-image">
          <img
            src="http://localhost:5001/qr-code/age_proof_25539_20250815_143229.png"
            alt="Sample QR Code"
            id="demoQR"
          />
        </div>
        <div>
          <button class="download-btn" onclick="downloadDemoQR()">
            üì• Download This QR Code
          </button>
          <p class="info">
            <strong>Demo QR Code:</strong>
            age_proof_25539_20250815_143229.png<br />
            This is a real QR code generated by your backend system!
          </p>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h2>üîß How It Works</h2>

      <h3>1. Backend QR Code Serving</h3>
      <div class="code-block">
        @app.route('/qr-code/&lt;path:filename&gt;', methods=['GET']) def
        serve_qr_code(filename): """Serve QR code images""" qr_code_path =
        os.path.join(age_prover.qr_folder, filename) return
        send_file(qr_code_path, mimetype='image/png')
      </div>

      <h3>2. Frontend Image Loading</h3>
      <div class="code-block">
        const loadQRCodeImage = async (qrCodePath: string) => { const imageUrl =
        `${backendUrl}/qr-code/${encodeURIComponent(qrCodePath)}`; const
        response = await fetch(imageUrl); const blob = await response.blob();
        const dataUrl = URL.createObjectURL(blob); setQrCodeImage(dataUrl); };
      </div>

      <h3>3. Download Functionality</h3>
      <div class="code-block">
        const downloadQRCode = () => { const link = document.createElement('a');
        link.href = qrCodeImage; link.download = `qr_code_${alias}_${date}.png`;
        link.click(); };
      </div>
    </div>

    <div class="demo-section">
      <h2>üöÄ Try It Yourself</h2>
      <div class="success">
        <strong>Ready to test!</strong> Your system now supports:
        <ul>
          <li>‚úÖ Generate QR codes with the form</li>
          <li>‚úÖ See QR codes displayed immediately</li>
          <li>‚úÖ Download QR codes directly</li>
          <li>‚úÖ Scan QR codes with camera or upload</li>
          <li>‚úÖ Verify proofs with your backend</li>
        </ul>
      </div>

      <p><strong>Next steps:</strong></p>
      <ol>
        <li>Start your backend: <code>python3 app.py</code></li>
        <li>Start your frontend: <code>cd notrust && npm run dev</code></li>
        <li>
          Open
          <a href="http://localhost:3000" target="_blank"
            >http://localhost:3000</a
          >
        </li>
        <li>Generate a new QR code and see it displayed!</li>
      </ol>
    </div>

    <script>
      function downloadDemoQR() {
        const img = document.getElementById("demoQR");
        const link = document.createElement("a");
        link.href = img.src;
        link.download = "demo_qr_code.png";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Show success message
        const successDiv = document.createElement("div");
        successDiv.className = "success";
        successDiv.innerHTML = "‚úÖ QR Code downloaded successfully!";
        document.body.appendChild(successDiv);

        // Remove after 3 seconds
        setTimeout(() => {
          document.body.removeChild(successDiv);
        }, 3000);
      }

      // Test if the backend is accessible
      fetch("http://localhost:5001/health")
        .then((response) => response.json())
        .then((data) => {
          console.log("Backend status:", data);
        })
        .catch((error) => {
          console.error("Backend not accessible:", error);
          document.body.innerHTML += `
                    <div class="demo-section" style="background: #f8d7da; border-color: #f5c6cb;">
                        <h2>‚ö†Ô∏è Backend Not Running</h2>
                        <p>Please start your backend with: <code>python3 app.py</code></p>
                    </div>
                `;
        });
    </script>
  </body>
</html>
